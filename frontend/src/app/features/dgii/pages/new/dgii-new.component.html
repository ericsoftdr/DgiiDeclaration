<div class="card p-fluid">
    <p-toast/>
    <h5>Registrar compañia</h5>
    <div class="p-formgrid grid">
        <div class="field col">
            <label htmlFor="Rnc">Rnc</label>
            <input pInputText type="text" id="Rnc" maxlength="11" [(ngModel)]="companyCredential.rnc" (blur)="onRncBlur()"/>
        </div>
        <div class="field col">
            <label htmlFor="company">Compañia</label>
            <input pInputText id="company" type="text" maxlength="128" [(ngModel)]="companyCredential.companyName" [disabled]="isLoadingCompanyName"/>
        </div>
    </div>
    <div class="p-formgrid grid">
        <div class="field col">
            <label htmlFor="pwd">Password</label>
            <input pInputText id="pwd" type="text" maxlength="128" [(ngModel)]="companyCredential.pwd"/>
        </div>
        <div class="field col">
            <div class="flex row pt-5">
                <div class="flex align-items-center">
                    <span>Token requerido</span>
                    <p-inputSwitch [(ngModel)]="companyCredential.tokenRequired" (ngModelChange)="onTokenRequiredChange($event)" class="px-2" />
                </div>
                <div class="flex align-items-center px-2">
                    <span>Procesar</span>
                    <p-inputSwitch [(ngModel)]="companyCredential.selectedForProcessing" class="px-2" />
                </div>
            </div>

        </div>
    </div>

    <div class="p-formgrid grid">
        <div class="field col-6">
            <label htmlFor="manager">Asesor</label>
            <p-dropdown
                [options]="managers"
                [(ngModel)]="selectedManager"
                optionLabel="managerName"
                [filter]="true"
                filterBy="managerName"
                [showClear]="true"
                placeholder="Selecciona un asesor">
            </p-dropdown>
        </div>
        <div class="field col-3 pt-5">
            <input
                type="file"
                id="fileInput"
                #fileInput
                (change)="onFileChange($event)"
                style="display: none"
                accept="image/*,application/pdf"
            />
            <p-button
                [label]="selectedFile !== null  ? selectedFile.name : 'Cargar Archivo'"
                icon="pi pi-upload"
                (click)="fileInput.click()"
            ></p-button>
        </div>
    </div>

    <div class="p-formgrid grid pt-3 pb-2" *ngIf="companyCredential.tokenRequired && selectedTokens.length > 0">
        <p-fieldset legend="Tokens" class="field col-12 pt-5">
            <p-table [value]="selectedTokens" dataKey="tokenId" [tableStyle]="{'min-width': '80rem'}" styleClass="p-datatable-gridlines" >
                <ng-template pTemplate="header">
                    <tr>
                        <th>No.</th>
                        <th>Valor</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-token let-ri="rowIndex">
                    <tr>
                        <td>{{token.tokenId}}</td>
                        <td>
                            <input
                                #tokenInput
                                minlength="4"
                                maxlength="5"
                                pInputText
                                type="text"
                                [(ngModel)]="token.tokenValue"
                                (keypress)="onlyNumbers($event)"
                                (keydown.enter)="focusNextInput(ri)"
                                required />
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </p-fieldset>
    </div>

    <div class="flex flex-wrap gap-3 justify-content-end">

        <p-button label="Retornar al listado" [raised]="true" severity="secondary" (onClick)="redirectToList()"/>
        <p-button label="Guardar" [raised]="true" (onClick)="saveCompany()"/>
    </div>
</div>
